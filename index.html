<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentylyze - Hebelwerk Momentumtabelle</title>
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator_modern.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>

</head>

<body>

    <div id="sp500"></div>
    <script type="text/javascript">
        var tabledata = [{"rank":1,"ticker":"CTRA","momentum":158.4002031496,"atr":0.79675,"price":20.22,"sector":"Energy","shares":313,"position":6328.86},{"rank":2,"ticker":"EOG","momentum":155.0749017889,"atr":3.583995,"price":85.99,"sector":"Energy","shares":69,"position":5933.31},{"rank":3,"ticker":"TMO","momentum":64.6250276161,"atr":14.75472,"price":636.11,"sector":"Health Care","shares":16,"position":10177.76},{"rank":4,"ticker":"VRSK","momentum":57.8939586578,"atr":4.819655,"price":221.65,"sector":"Industrials","shares":51,"position":11304.15},{"rank":5,"ticker":"PBCT","momentum":37.8683393628,"atr":0.53557,"price":17.0,"sector":"Financials","shares":466,"position":7922.0},{"rank":6,"ticker":"GM","momentum":37.2965221409,"atr":2.280495,"price":59.71,"sector":"Consumer Discretionary","shares":109,"position":6508.39},{"rank":7,"ticker":"ACN","momentum":35.6925352326,"atr":6.9535,"price":361.42,"sector":"Information Technology","shares":35,"position":12649.7},{"rank":8,"ticker":"BKR","momentum":26.7772491644,"atr":0.913255,"price":23.94,"sector":"Energy","shares":273,"position":6535.62},{"rank":9,"ticker":"CVS","momentum":26.6860746965,"atr":1.93741,"price":90.87,"sector":"Health Care","shares":129,"position":11722.23},{"rank":10,"ticker":"HPQ","momentum":22.3894989657,"atr":1.1425,"price":37.55,"sector":"Information Technology","shares":218,"position":8185.9},{"rank":11,"ticker":"ADM","momentum":21.8530775516,"atr":1.3805,"price":62.53,"sector":"Consumer Staples","shares":181,"position":11317.93},{"rank":12,"ticker":"PFG","momentum":20.2647844389,"atr":1.790055,"price":69.18,"sector":"Financials","shares":139,"position":9616.02},{"rank":13,"ticker":"JNPR","momentum":19.4971333251,"atr":0.6528,"price":31.27,"sector":"Information Technology","shares":382,"position":11945.14},{"rank":14,"ticker":"EFX","momentum":14.3763653292,"atr":7.2016,"price":282.5,"sector":"Industrials","shares":34,"position":9605.0},{"rank":15,"ticker":"CTSH","momentum":13.5237872069,"atr":1.64975,"price":78.52,"sector":"Information Technology","shares":151,"position":11856.52},{"rank":16,"ticker":"MAS","momentum":12.6445796561,"atr":1.411455,"price":68.76,"sector":"Industrials","shares":177,"position":12170.52},{"rank":17,"ticker":"STZ","momentum":6.7777656072,"atr":4.4713,"price":226.19,"sector":"Consumer Staples","shares":55,"position":12440.45},{"rank":18,"ticker":"PSA","momentum":4.3931305931,"atr":7.20185,"price":335.34,"sector":"Real Estate","shares":34,"position":11401.56},{"rank":19,"ticker":"BLL","momentum":3.5154637175,"atr":2.11515,"price":93.23,"sector":"Materials","shares":118,"position":11001.14},{"rank":20,"ticker":"ED","momentum":1.89543775,"atr":1.4235,"price":80.53,"sector":"Utilities","shares":175,"position":14092.75},{"rank":21,"ticker":"DD","momentum":0.823459003,"atr":1.98295,"price":75.48,"sector":"Materials","shares":126,"position":9510.48},{"rank":22,"ticker":"IEX","momentum":0.7531467377,"atr":4.122255,"price":228.29,"sector":"Industrials","shares":60,"position":13697.4},{"rank":23,"ticker":"ABT","momentum":0.4947182218,"atr":2.61784,"price":130.27,"sector":"Health Care","shares":95,"position":12375.65},{"rank":24,"ticker":"UA","momentum":0.1951812507,"atr":0.77955,"price":19.98,"sector":"Consumer Discretionary","shares":320,"position":6393.6},{"rank":25,"ticker":"NXPI","momentum":0.0146251629,"atr":7.10957,"price":227.12,"sector":"Information Technology","shares":35,"position":7949.2},{"rank":26,"ticker":"DHI","momentum":0.0078239971,"atr":2.884745,"price":102.54,"sector":"Consumer Discretionary","shares":86,"position":8818.44},{"rank":27,"ticker":"PEG","momentum":-0.0794471481,"atr":1.07745,"price":63.45,"sector":"Utilities","shares":232,"position":14720.4},{"rank":28,"ticker":"NUE","momentum":-0.1871956028,"atr":4.934365,"price":110.5,"sector":"Materials","shares":50,"position":5525.0},{"rank":29,"ticker":"CDW","momentum":-0.3639887671,"atr":5.246775,"price":191.67,"sector":"Information Technology","shares":47,"position":9008.49},{"rank":30,"ticker":"MKC","momentum":-1.2843473842,"atr":1.4481,"price":88.54,"sector":"Consumer Staples","shares":172,"position":15228.88}];

        const sectorTypes = ["Communication Services", "Consumer Discretionary", "Consumer Staples", "Energy", "Financials", "Health Care", "Industrials", "Information Technology", "Materials", "Real Estate", "Utilities"];
        function multiSelectHeaderFilter(cell) {
            var values = sectorTypes;

            const filterFunc = (rowData) => {
                return values.includes(rowData['sector']);
            }

            const getSelectedValues = (multiSelect) => {
                var result = [];
                var options = multiSelect && multiSelect.options;
                var opt;

                for (var i = 0, iLen = options.length; i < iLen; i++) {
                opt = options[i];

                if (opt.selected) {
                    result.push(opt.value || opt.text);
                }
                }
                return result;
            }

            const onChange = () => {
                var editor = document.getElementById('sectorSelector');
                values = getSelectedValues(editor);
                console.log("values: " + values);
                cell.getColumn().getTable().removeFilter(filterFunc);
                cell.getColumn().getTable().addFilter(filterFunc);
            }

            var select = document.createElement("select");
            select.multiple = "multiple";
            select.id = 'sectorSelector';
            select.class = "chosen-select";
            select.style = 'width: 100%';
            sectorTypes.forEach(sector => {
                select.innerHTML += "<option id='" + sector + "' value='" + sector + "' selected='selected'>" + sector + "</option>";
            });
            cell.getColumn().getTable().addFilter(filterFunc);
            select.addEventListener('change', onChange);

            return select;
        }

        var table = new Tabulator("#sp500", {
            data: tabledata,
            layout: "fitColumns",
            pagination: "local",
            paginationSize: 500,
            tooltips: true,
            columns: [{
                    title: "Rank",
                    field: "rank",
                    sorter: "number",
                }, 
                {
                    title: "Ticker",
                    field: "ticker",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: "input"
                },
                {
                    title: "Sector",
                    field: "sector",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: multiSelectHeaderFilter, 
                    headerFilterLiveFilter: false
                },
                {
                    title: "Momentum",
                    field: "momentum",
                    sorter: "number",
                    hozAlign: "left",
                }, 
                {
                    title: "ATR20d",
                    field: "atr",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Price ($)",
                    field: "price",
                    sorter: "money",
                    hozAlign: "left",
                },
                {
                    title: "Shares",
                    field: "shares",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Position ($)",
                    field: "position",
                    sorter: "money",
                    hozAlign: "left",
                },
            ],
        });
    </script>
</body>

</html>

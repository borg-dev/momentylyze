<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentylyze - Hebelwerk Momentumtabelle</title>
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator_modern.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>

</head>

<body>

    <div id="sp500"></div>
    <script type="text/javascript">
        var tabledata = [{"rank":1,"ticker":"VLO","momentum":316.8151638624,"atr":5.975555,"price":116.47,"sector":"Energy","shares":41,"position":4775.27},{"rank":2,"ticker":"MPC","momentum":142.3716024225,"atr":4.008795,"price":91.36,"sector":"Energy","shares":62,"position":5664.32},{"rank":3,"ticker":"CEG","momentum":76.5978279777,"atr":3.066575,"price":60.38,"sector":"Utilities","shares":81,"position":4890.78},{"rank":4,"ticker":"XOM","momentum":71.8167802809,"atr":3.286265,"price":91.48,"sector":"Energy","shares":76,"position":6952.48},{"rank":5,"ticker":"MRK","momentum":59.2178419762,"atr":1.84725,"price":88.03,"sector":"Health Care","shares":135,"position":11884.05},{"rank":6,"ticker":"PSX","momentum":55.0057384753,"atr":3.85993,"price":95.98,"sector":"Energy","shares":64,"position":6142.72},{"rank":7,"ticker":"LLY","momentum":54.1386914152,"atr":9.02375,"price":297.34,"sector":"Health Care","shares":27,"position":8028.18},{"rank":8,"ticker":"T","momentum":50.0809980833,"atr":0.44848,"price":19.96,"sector":"Communication Services","shares":557,"position":11117.72},{"rank":9,"ticker":"MCK","momentum":42.0312554956,"atr":8.1795,"price":309.38,"sector":"Health Care","shares":30,"position":9281.4},{"rank":10,"ticker":"WRB","momentum":39.211067008,"atr":1.479755,"price":67.53,"sector":"Financials","shares":168,"position":11345.04},{"rank":11,"ticker":"CI","momentum":30.8050846352,"atr":7.028,"price":252.18,"sector":"Health Care","shares":35,"position":8826.3},{"rank":12,"ticker":"BMY","momentum":29.1549379769,"atr":1.51093,"price":76.47,"sector":"Health Care","shares":165,"position":12617.55},{"rank":13,"ticker":"MNST","momentum":25.0456624325,"atr":2.3046,"price":90.84,"sector":"Consumer Staples","shares":108,"position":9810.72},{"rank":14,"ticker":"K","momentum":21.2080677349,"atr":1.59595,"price":68.86,"sector":"Consumer Staples","shares":156,"position":10742.16},{"rank":15,"ticker":"IBM","momentum":20.9207915861,"atr":2.98644,"price":137.85,"sector":"Information Technology","shares":83,"position":11441.55},{"rank":16,"ticker":"NOC","momentum":18.0620730731,"atr":13.421,"price":463.77,"sector":"Industrials","shares":18,"position":8347.86},{"rank":17,"ticker":"GPC","momentum":17.9109142357,"atr":3.21034,"price":130.81,"sector":"Consumer Discretionary","shares":77,"position":10072.37},{"rank":18,"ticker":"VRTX","momentum":14.3469283872,"atr":8.39275,"price":270.17,"sector":"Health Care","shares":29,"position":7834.93},{"rank":19,"ticker":"CPB","momentum":13.6301694397,"atr":1.30794,"price":47.0,"sector":"Consumer Staples","shares":191,"position":8977.0},{"rank":20,"ticker":"VICI","momentum":12.8813876761,"atr":1.04802,"price":29.86,"sector":"Real Estate","shares":238,"position":7106.68},{"rank":21,"ticker":"DG","momentum":10.773839384,"atr":7.595475,"price":238.97,"sector":"Consumer Discretionary","shares":32,"position":7647.04},{"rank":22,"ticker":"PGR","momentum":9.5662175479,"atr":2.7035,"price":112.18,"sector":"Financials","shares":92,"position":10320.56},{"rank":23,"ticker":"HII","momentum":7.6865562439,"atr":5.22297,"price":209.36,"sector":"Industrials","shares":47,"position":9839.92},{"rank":24,"ticker":"TMUS","momentum":3.9243427933,"atr":3.44597,"price":131.67,"sector":"Communication Services","shares":72,"position":9480.24},{"rank":25,"ticker":"AZO","momentum":3.8777894927,"atr":58.74688,"price":2032.12,"sector":"Consumer Discretionary","shares":4,"position":8128.48},{"rank":26,"ticker":"AMT","momentum":3.3913137879,"atr":8.648505,"price":246.85,"sector":"Real Estate","shares":28,"position":6911.8},{"rank":27,"ticker":"ULTA","momentum":3.3562476445,"atr":17.329545,"price":401.26,"sector":"Consumer Discretionary","shares":14,"position":5617.64},{"rank":28,"ticker":"PWR","momentum":3.3183306377,"atr":5.29309,"price":119.23,"sector":"Industrials","shares":47,"position":5603.81},{"rank":29,"ticker":"HSY","momentum":1.6854696528,"atr":4.531745,"price":215.07,"sector":"Consumer Staples","shares":55,"position":11828.85},{"rank":30,"ticker":"EA","momentum":0.4848417069,"atr":3.4135,"price":130.39,"sector":"Communication Services","shares":73,"position":9518.47},{"rank":31,"ticker":"CTLT","momentum":0.0279397241,"atr":3.595775,"price":103.99,"sector":"Health Care","shares":69,"position":7175.31},{"rank":32,"ticker":"BF.B","momentum":0.0012678803,"atr":1.70506,"price":68.69,"sector":"Consumer Staples","shares":146,"position":10028.74}];

        const sectorTypes = ["Communication Services", "Consumer Discretionary", "Consumer Staples", "Energy", "Financials", "Health Care", "Industrials", "Information Technology", "Materials", "Real Estate", "Utilities"];
        function multiSelectHeaderFilter(cell) {
            var values = sectorTypes;

            const filterFunc = (rowData) => {
                return values.includes(rowData['sector']);
            }

            const getSelectedValues = (multiSelect) => {
                var result = [];
                var options = multiSelect && multiSelect.options;
                var opt;

                for (var i = 0, iLen = options.length; i < iLen; i++) {
                opt = options[i];

                if (opt.selected) {
                    result.push(opt.value || opt.text);
                }
                }
                return result;
            }

            const onChange = () => {
                var editor = document.getElementById('sectorSelector');
                values = getSelectedValues(editor);
                console.log("values: " + values);
                cell.getColumn().getTable().removeFilter(filterFunc);
                cell.getColumn().getTable().addFilter(filterFunc);
            }

            var select = document.createElement("select");
            select.multiple = "multiple";
            select.id = 'sectorSelector';
            select.class = "chosen-select";
            select.style = 'width: 100%';
            sectorTypes.forEach(sector => {
                select.innerHTML += "<option id='" + sector + "' value='" + sector + "' selected='selected'>" + sector + "</option>";
            });
            cell.getColumn().getTable().addFilter(filterFunc);
            select.addEventListener('change', onChange);

            return select;
        }

        var table = new Tabulator("#sp500", {
            data: tabledata,
            layout: "fitColumns",
            pagination: "local",
            paginationSize: 500,
            tooltips: true,
            columns: [{
                    title: "Rank",
                    field: "rank",
                    sorter: "number",
                }, 
                {
                    title: "Ticker",
                    field: "ticker",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: "input"
                },
                {
                    title: "Sector",
                    field: "sector",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: multiSelectHeaderFilter, 
                    headerFilterLiveFilter: false
                },
                {
                    title: "Momentum",
                    field: "momentum",
                    sorter: "number",
                    hozAlign: "left",
                }, 
                {
                    title: "ATR20d",
                    field: "atr",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Price ($)",
                    field: "price",
                    sorter: "money",
                    hozAlign: "left",
                },
                {
                    title: "Shares",
                    field: "shares",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Position ($)",
                    field: "position",
                    sorter: "money",
                    hozAlign: "left",
                },
            ],
        });
    </script>
</body>

</html>

<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentylyze - Hebelwerk Momentumtabelle</title>
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator_modern.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>

</head>

<body>

    <div id="sp500"></div>
    <script type="text/javascript">
        var tabledata = [{"rank":1,"ticker":"VLO","momentum":348.8158086418,"atr":5.673135,"price":128.3,"sector":"Energy","shares":44,"position":5645.2},{"rank":2,"ticker":"CTRA","momentum":223.3405080587,"atr":1.4265,"price":30.67,"sector":"Energy","shares":175,"position":5367.25},{"rank":3,"ticker":"MPC","momentum":158.1239523887,"atr":3.52246,"price":98.9,"sector":"Energy","shares":70,"position":6923.0},{"rank":4,"ticker":"DVN","momentum":136.6915234269,"atr":3.14007,"price":68.46,"sector":"Energy","shares":79,"position":5408.34},{"rank":5,"ticker":"CEG","momentum":94.528987846,"atr":3.078575,"price":58.2,"sector":"Utilities","shares":81,"position":4714.2},{"rank":6,"ticker":"XOM","momentum":77.2484731333,"atr":2.927515,"price":94.89,"sector":"Energy","shares":85,"position":8065.65},{"rank":7,"ticker":"MRK","momentum":68.9728624492,"atr":1.69025,"price":84.63,"sector":"Health Care","shares":147,"position":12440.61},{"rank":8,"ticker":"LLY","momentum":68.8656491053,"atr":9.05325,"price":292.99,"sector":"Health Care","shares":27,"position":7910.73},{"rank":9,"ticker":"COP","momentum":55.8521674207,"atr":4.346155,"price":109.33,"sector":"Energy","shares":57,"position":6231.81},{"rank":10,"ticker":"MCK","momentum":55.3831944735,"atr":8.48525,"price":307.68,"sector":"Health Care","shares":29,"position":8922.72},{"rank":11,"ticker":"PXD","momentum":53.9226189913,"atr":9.570245,"price":258.21,"sector":"Energy","shares":26,"position":6713.46},{"rank":12,"ticker":"CVX","momentum":50.7568524077,"atr":4.821735,"price":164.26,"sector":"Energy","shares":51,"position":8377.26},{"rank":13,"ticker":"PSX","momentum":46.5189221043,"atr":3.499515,"price":102.38,"sector":"Energy","shares":71,"position":7268.98},{"rank":14,"ticker":"WRB","momentum":45.5800401295,"atr":1.546505,"price":67.01,"sector":"Financials","shares":161,"position":10788.61},{"rank":15,"ticker":"CI","momentum":39.4230191146,"atr":7.028,"price":247.1,"sector":"Health Care","shares":35,"position":8648.5},{"rank":16,"ticker":"BMY","momentum":37.5428165297,"atr":1.43368,"price":73.02,"sector":"Health Care","shares":174,"position":12705.48},{"rank":17,"ticker":"AMCR","momentum":35.7373448031,"atr":0.337885,"price":12.1,"sector":"Materials","shares":739,"position":8941.9},{"rank":18,"ticker":"NOC","momentum":27.7722481418,"atr":13.0393,"price":458.45,"sector":"Industrials","shares":19,"position":8710.55},{"rank":19,"ticker":"K","momentum":25.9936419949,"atr":1.74345,"price":67.8,"sector":"Consumer Staples","shares":143,"position":9695.4},{"rank":20,"ticker":"CHRW","momentum":20.1910260539,"atr":3.71186,"price":103.14,"sector":"Industrials","shares":67,"position":6910.38},{"rank":21,"ticker":"GPC","momentum":18.6971711388,"atr":3.57959,"price":132.42,"sector":"Consumer Discretionary","shares":69,"position":9136.98},{"rank":22,"ticker":"MNST","momentum":17.4227710912,"atr":2.29035,"price":87.87,"sector":"Consumer Staples","shares":109,"position":9577.83},{"rank":23,"ticker":"HII","momentum":13.4747852186,"atr":5.143665,"price":205.67,"sector":"Industrials","shares":48,"position":9872.16},{"rank":24,"ticker":"VICI","momentum":12.7525211208,"atr":1.00752,"price":29.27,"sector":"Real Estate","shares":248,"position":7258.96},{"rank":25,"ticker":"IBM","momentum":12.4984587825,"atr":3.22244,"price":137.06,"sector":"Information Technology","shares":77,"position":10553.62},{"rank":26,"ticker":"DG","momentum":12.3668718284,"atr":9.78497,"price":232.25,"sector":"Consumer Discretionary","shares":25,"position":5806.25},{"rank":27,"ticker":"FANG","momentum":11.834428236,"atr":6.262125,"price":146.76,"sector":"Energy","shares":39,"position":5723.64},{"rank":28,"ticker":"PGR","momentum":11.3749413684,"atr":2.7925,"price":112.57,"sector":"Financials","shares":89,"position":10018.73},{"rank":29,"ticker":"PWR","momentum":8.381055017,"atr":5.06284,"price":124.12,"sector":"Industrials","shares":49,"position":6081.88},{"rank":30,"ticker":"TMUS","momentum":4.9378885672,"atr":3.251465,"price":126.52,"sector":"Communication Services","shares":76,"position":9615.52},{"rank":31,"ticker":"ULTA","momentum":4.4019001684,"atr":19.502545,"price":405.61,"sector":"Consumer Discretionary","shares":12,"position":4867.32},{"rank":32,"ticker":"AZO","momentum":3.49601977,"atr":76.414865,"price":2013.81,"sector":"Consumer Discretionary","shares":3,"position":6041.43},{"rank":33,"ticker":"EA","momentum":0.0976686156,"atr":3.662495,"price":129.26,"sector":"Communication Services","shares":68,"position":8789.68},{"rank":34,"ticker":"WAT","momentum":0.0700004299,"atr":10.54298,"price":324.26,"sector":"Health Care","shares":23,"position":7457.98},{"rank":35,"ticker":"CTLT","momentum":0.0090539171,"atr":3.711775,"price":104.96,"sector":"Health Care","shares":67,"position":7032.32},{"rank":36,"ticker":"BF.B","momentum":-0.000971274,"atr":1.89056,"price":67.09,"sector":"Consumer Staples","shares":132,"position":8855.88}];

        const sectorTypes = ["Communication Services", "Consumer Discretionary", "Consumer Staples", "Energy", "Financials", "Health Care", "Industrials", "Information Technology", "Materials", "Real Estate", "Utilities"];
        function multiSelectHeaderFilter(cell) {
            var values = sectorTypes;

            const filterFunc = (rowData) => {
                return values.includes(rowData['sector']);
            }

            const getSelectedValues = (multiSelect) => {
                var result = [];
                var options = multiSelect && multiSelect.options;
                var opt;

                for (var i = 0, iLen = options.length; i < iLen; i++) {
                opt = options[i];

                if (opt.selected) {
                    result.push(opt.value || opt.text);
                }
                }
                return result;
            }

            const onChange = () => {
                var editor = document.getElementById('sectorSelector');
                values = getSelectedValues(editor);
                console.log("values: " + values);
                cell.getColumn().getTable().removeFilter(filterFunc);
                cell.getColumn().getTable().addFilter(filterFunc);
            }

            var select = document.createElement("select");
            select.multiple = "multiple";
            select.id = 'sectorSelector';
            select.class = "chosen-select";
            select.style = 'width: 100%';
            sectorTypes.forEach(sector => {
                select.innerHTML += "<option id='" + sector + "' value='" + sector + "' selected='selected'>" + sector + "</option>";
            });
            cell.getColumn().getTable().addFilter(filterFunc);
            select.addEventListener('change', onChange);

            return select;
        }

        var table = new Tabulator("#sp500", {
            data: tabledata,
            layout: "fitColumns",
            pagination: "local",
            paginationSize: 500,
            tooltips: true,
            columns: [{
                    title: "Rank",
                    field: "rank",
                    sorter: "number",
                }, 
                {
                    title: "Ticker",
                    field: "ticker",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: "input"
                },
                {
                    title: "Sector",
                    field: "sector",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: multiSelectHeaderFilter, 
                    headerFilterLiveFilter: false
                },
                {
                    title: "Momentum",
                    field: "momentum",
                    sorter: "number",
                    hozAlign: "left",
                }, 
                {
                    title: "ATR20d",
                    field: "atr",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Price ($)",
                    field: "price",
                    sorter: "money",
                    hozAlign: "left",
                },
                {
                    title: "Shares",
                    field: "shares",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Position ($)",
                    field: "position",
                    sorter: "money",
                    hozAlign: "left",
                },
            ],
        });
    </script>
</body>

</html>

<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentylyze - Hebelwerk Momentumtabelle</title>
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator_modern.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>

</head>

<body>

    <div id="sp500"></div>
    <script type="text/javascript">
        var tabledata = [{"rank":1,"ticker":"VLO","momentum":342.8404787456,"atr":5.900135,"price":118.74,"sector":"Energy","shares":42,"position":4987.08},{"rank":2,"ticker":"CTRA","momentum":207.0330948349,"atr":1.4785,"price":28.63,"sector":"Energy","shares":169,"position":4838.47},{"rank":3,"ticker":"MPC","momentum":154.9964595442,"atr":3.72296,"price":91.98,"sector":"Energy","shares":67,"position":6162.66},{"rank":4,"ticker":"DVN","momentum":126.2770377616,"atr":3.21407,"price":63.27,"sector":"Energy","shares":77,"position":4871.79},{"rank":5,"ticker":"CEG","momentum":87.7082504093,"atr":3.025825,"price":58.26,"sector":"Utilities","shares":82,"position":4777.32},{"rank":6,"ticker":"XOM","momentum":77.992250178,"atr":3.003515,"price":91.39,"sector":"Energy","shares":83,"position":7585.37},{"rank":7,"ticker":"MRK","momentum":65.3986953855,"atr":1.72775,"price":84.89,"sector":"Health Care","shares":144,"position":12224.16},{"rank":8,"ticker":"LLY","momentum":63.2802377859,"atr":9.11875,"price":288.07,"sector":"Health Care","shares":27,"position":7777.89},{"rank":9,"ticker":"COP","momentum":52.644921097,"atr":4.489155,"price":102.42,"sector":"Energy","shares":55,"position":5633.1},{"rank":10,"ticker":"PSX","momentum":50.6629448576,"atr":3.608015,"price":96.5,"sector":"Energy","shares":69,"position":6658.5},{"rank":11,"ticker":"MCK","momentum":50.0786596338,"atr":8.174,"price":304.02,"sector":"Health Care","shares":30,"position":9120.6},{"rank":12,"ticker":"WRB","momentum":42.5460757323,"atr":1.562005,"price":66.3,"sector":"Financials","shares":160,"position":10608.0},{"rank":13,"ticker":"CI","momentum":35.8612714734,"atr":6.674,"price":248.3,"sector":"Health Care","shares":37,"position":9187.1},{"rank":14,"ticker":"BMY","momentum":33.5738475072,"atr":1.41793,"price":72.62,"sector":"Health Care","shares":176,"position":12781.12},{"rank":15,"ticker":"K","momentum":24.244047332,"atr":1.57995,"price":67.67,"sector":"Consumer Staples","shares":158,"position":10691.86},{"rank":16,"ticker":"NOC","momentum":23.9508006802,"atr":13.0468,"price":449.02,"sector":"Industrials","shares":19,"position":8531.38},{"rank":17,"ticker":"MNST","momentum":19.2424090724,"atr":2.25435,"price":87.89,"sector":"Consumer Staples","shares":110,"position":9667.9},{"rank":18,"ticker":"IBM","momentum":14.8412741159,"atr":3.04594,"price":135.67,"sector":"Information Technology","shares":82,"position":11124.94},{"rank":19,"ticker":"VICI","momentum":12.2911915317,"atr":1.03077,"price":28.76,"sector":"Real Estate","shares":242,"position":6959.92},{"rank":20,"ticker":"DG","momentum":11.5773054458,"atr":8.47847,"price":232.23,"sector":"Consumer Discretionary","shares":29,"position":6734.67},{"rank":21,"ticker":"ULTA","momentum":3.8161385765,"atr":17.968545,"price":390.47,"sector":"Consumer Discretionary","shares":13,"position":5076.11},{"rank":22,"ticker":"AZO","momentum":3.5359478596,"atr":68.020365,"price":2001.16,"sector":"Consumer Discretionary","shares":3,"position":6003.48}];

        const sectorTypes = ["Communication Services", "Consumer Discretionary", "Consumer Staples", "Energy", "Financials", "Health Care", "Industrials", "Information Technology", "Materials", "Real Estate", "Utilities"];
        function multiSelectHeaderFilter(cell) {
            var values = sectorTypes;

            const filterFunc = (rowData) => {
                return values.includes(rowData['sector']);
            }

            const getSelectedValues = (multiSelect) => {
                var result = [];
                var options = multiSelect && multiSelect.options;
                var opt;

                for (var i = 0, iLen = options.length; i < iLen; i++) {
                opt = options[i];

                if (opt.selected) {
                    result.push(opt.value || opt.text);
                }
                }
                return result;
            }

            const onChange = () => {
                var editor = document.getElementById('sectorSelector');
                values = getSelectedValues(editor);
                console.log("values: " + values);
                cell.getColumn().getTable().removeFilter(filterFunc);
                cell.getColumn().getTable().addFilter(filterFunc);
            }

            var select = document.createElement("select");
            select.multiple = "multiple";
            select.id = 'sectorSelector';
            select.class = "chosen-select";
            select.style = 'width: 100%';
            sectorTypes.forEach(sector => {
                select.innerHTML += "<option id='" + sector + "' value='" + sector + "' selected='selected'>" + sector + "</option>";
            });
            cell.getColumn().getTable().addFilter(filterFunc);
            select.addEventListener('change', onChange);

            return select;
        }

        var table = new Tabulator("#sp500", {
            data: tabledata,
            layout: "fitColumns",
            pagination: "local",
            paginationSize: 500,
            tooltips: true,
            columns: [{
                    title: "Rank",
                    field: "rank",
                    sorter: "number",
                }, 
                {
                    title: "Ticker",
                    field: "ticker",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: "input"
                },
                {
                    title: "Sector",
                    field: "sector",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: multiSelectHeaderFilter, 
                    headerFilterLiveFilter: false
                },
                {
                    title: "Momentum",
                    field: "momentum",
                    sorter: "number",
                    hozAlign: "left",
                }, 
                {
                    title: "ATR20d",
                    field: "atr",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Price ($)",
                    field: "price",
                    sorter: "money",
                    hozAlign: "left",
                },
                {
                    title: "Shares",
                    field: "shares",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Position ($)",
                    field: "position",
                    sorter: "money",
                    hozAlign: "left",
                },
            ],
        });
    </script>
</body>

</html>

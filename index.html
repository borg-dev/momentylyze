<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentylyze - Hebelwerk Momentumtabelle</title>
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator_modern.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>

</head>

<body>

    <div id="sp500"></div>
    <script type="text/javascript">
        var tabledata = [{"rank":1,"ticker":"VLO","momentum":348.3156789367,"atr":5.454135,"price":133.75,"sector":"Energy","shares":45,"position":6018.75},{"rank":2,"ticker":"CTRA","momentum":231.3973595493,"atr":1.4175,"price":31.11,"sector":"Energy","shares":176,"position":5475.36},{"rank":3,"ticker":"MPC","momentum":156.8085100443,"atr":3.33146,"price":102.67,"sector":"Energy","shares":75,"position":7700.25},{"rank":4,"ticker":"DVN","momentum":140.6298443243,"atr":3.04807,"price":70.59,"sector":"Energy","shares":82,"position":5788.38},{"rank":5,"ticker":"CEG","momentum":97.4334002984,"atr":2.997825,"price":54.44,"sector":"Utilities","shares":83,"position":4518.52},{"rank":6,"ticker":"XOM","momentum":75.1761826434,"atr":2.837515,"price":96.1,"sector":"Energy","shares":88,"position":8456.8},{"rank":7,"ticker":"LLY","momentum":73.7380389073,"atr":9.16325,"price":290.79,"sector":"Health Care","shares":27,"position":7851.33},{"rank":8,"ticker":"MRK","momentum":72.1527197938,"atr":1.762,"price":84.5,"sector":"Health Care","shares":141,"position":11914.5},{"rank":9,"ticker":"MCK","momentum":60.6708295429,"atr":8.56475,"price":306.52,"sector":"Health Care","shares":29,"position":8889.08},{"rank":10,"ticker":"COP","momentum":56.3820462552,"atr":4.26275,"price":111.49,"sector":"Energy","shares":58,"position":6466.42},{"rank":11,"ticker":"CVX","momentum":56.3446035964,"atr":4.678235,"price":167.55,"sector":"Energy","shares":53,"position":8880.15},{"rank":12,"ticker":"WRB","momentum":48.4359240433,"atr":1.536505,"price":66.74,"sector":"Financials","shares":162,"position":10811.88},{"rank":13,"ticker":"CTVA","momentum":43.0272514709,"atr":1.59115,"price":56.39,"sector":"Materials","shares":157,"position":8853.23},{"rank":14,"ticker":"BMY","momentum":41.7657101376,"atr":1.45818,"price":72.87,"sector":"Health Care","shares":171,"position":12460.77},{"rank":15,"ticker":"PSX","momentum":41.4728047152,"atr":3.364265,"price":104.13,"sector":"Energy","shares":74,"position":7705.62},{"rank":16,"ticker":"HAL","momentum":38.7512348531,"atr":1.8013,"price":36.67,"sector":"Energy","shares":138,"position":5060.46},{"rank":17,"ticker":"AMCR","momentum":36.8462501231,"atr":0.338135,"price":12.09,"sector":"Materials","shares":739,"position":8934.51},{"rank":18,"ticker":"NOC","momentum":31.164830124,"atr":12.72805,"price":454.46,"sector":"Industrials","shares":19,"position":8634.74},{"rank":19,"ticker":"CF","momentum":30.9204246051,"atr":5.226705,"price":93.25,"sector":"Materials","shares":47,"position":4382.75},{"rank":20,"ticker":"K","momentum":27.7567928769,"atr":1.78845,"price":68.34,"sector":"Consumer Staples","shares":139,"position":9499.26},{"rank":21,"ticker":"CHRW","momentum":23.3513953632,"atr":3.61911,"price":106.35,"sector":"Industrials","shares":69,"position":7338.15},{"rank":22,"ticker":"AIZ","momentum":18.7725090092,"atr":4.257375,"price":176.01,"sector":"Financials","shares":58,"position":10208.58},{"rank":23,"ticker":"GPC","momentum":18.0357358481,"atr":3.53859,"price":132.44,"sector":"Consumer Discretionary","shares":70,"position":9270.8},{"rank":24,"ticker":"SLB","momentum":16.2700760687,"atr":1.986895,"price":43.22,"sector":"Energy","shares":125,"position":5402.5},{"rank":25,"ticker":"MNST","momentum":15.7909553396,"atr":2.22835,"price":88.06,"sector":"Consumer Staples","shares":112,"position":9862.72},{"rank":26,"ticker":"HII","momentum":15.7298591299,"atr":5.074755,"price":204.81,"sector":"Industrials","shares":49,"position":10035.69},{"rank":27,"ticker":"DG","momentum":13.0025711319,"atr":10.09297,"price":230.02,"sector":"Consumer Discretionary","shares":24,"position":5520.48},{"rank":28,"ticker":"PGR","momentum":11.5199225807,"atr":2.831,"price":112.41,"sector":"Financials","shares":88,"position":9892.08},{"rank":29,"ticker":"FANG","momentum":11.1528067903,"atr":6.137625,"price":149.63,"sector":"Energy","shares":40,"position":5985.2},{"rank":30,"ticker":"IBM","momentum":10.2555637123,"atr":3.24594,"price":135.72,"sector":"Information Technology","shares":77,"position":10450.44},{"rank":31,"ticker":"PWR","momentum":9.9321200654,"atr":5.0075,"price":123.55,"sector":"Industrials","shares":49,"position":6053.95},{"rank":32,"ticker":"ULTA","momentum":4.5576606167,"atr":19.280295,"price":392.67,"sector":"Consumer Discretionary","shares":12,"position":4712.04},{"rank":33,"ticker":"AZO","momentum":3.29124213,"atr":75.617365,"price":2033.58,"sector":"Consumer Discretionary","shares":3,"position":6100.74},{"rank":34,"ticker":"WAT","momentum":0.040143715,"atr":10.76748,"price":321.49,"sector":"Health Care","shares":23,"position":7394.27},{"rank":35,"ticker":"CTLT","momentum":0.0032367536,"atr":3.717775,"price":104.29,"sector":"Health Care","shares":67,"position":6987.43}];

        const sectorTypes = ["Communication Services", "Consumer Discretionary", "Consumer Staples", "Energy", "Financials", "Health Care", "Industrials", "Information Technology", "Materials", "Real Estate", "Utilities"];
        function multiSelectHeaderFilter(cell) {
            var values = sectorTypes;

            const filterFunc = (rowData) => {
                return values.includes(rowData['sector']);
            }

            const getSelectedValues = (multiSelect) => {
                var result = [];
                var options = multiSelect && multiSelect.options;
                var opt;

                for (var i = 0, iLen = options.length; i < iLen; i++) {
                opt = options[i];

                if (opt.selected) {
                    result.push(opt.value || opt.text);
                }
                }
                return result;
            }

            const onChange = () => {
                var editor = document.getElementById('sectorSelector');
                values = getSelectedValues(editor);
                console.log("values: " + values);
                cell.getColumn().getTable().removeFilter(filterFunc);
                cell.getColumn().getTable().addFilter(filterFunc);
            }

            var select = document.createElement("select");
            select.multiple = "multiple";
            select.id = 'sectorSelector';
            select.class = "chosen-select";
            select.style = 'width: 100%';
            sectorTypes.forEach(sector => {
                select.innerHTML += "<option id='" + sector + "' value='" + sector + "' selected='selected'>" + sector + "</option>";
            });
            cell.getColumn().getTable().addFilter(filterFunc);
            select.addEventListener('change', onChange);

            return select;
        }

        var table = new Tabulator("#sp500", {
            data: tabledata,
            layout: "fitColumns",
            pagination: "local",
            paginationSize: 500,
            tooltips: true,
            columns: [{
                    title: "Rank",
                    field: "rank",
                    sorter: "number",
                }, 
                {
                    title: "Ticker",
                    field: "ticker",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: "input"
                },
                {
                    title: "Sector",
                    field: "sector",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: multiSelectHeaderFilter, 
                    headerFilterLiveFilter: false
                },
                {
                    title: "Momentum",
                    field: "momentum",
                    sorter: "number",
                    hozAlign: "left",
                }, 
                {
                    title: "ATR20d",
                    field: "atr",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Price ($)",
                    field: "price",
                    sorter: "money",
                    hozAlign: "left",
                },
                {
                    title: "Shares",
                    field: "shares",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Position ($)",
                    field: "position",
                    sorter: "money",
                    hozAlign: "left",
                },
            ],
        });
    </script>
</body>

</html>

<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentylyze - Hebelwerk Momentumtabelle</title>
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator_modern.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>

</head>

<body>

    <div id="sp500"></div>
    <script type="text/javascript">
        var tabledata = [{"rank":1,"ticker":"VLO","momentum":327.3229049712,"atr":5.956555,"price":112.44,"sector":"Energy","shares":41,"position":4610.04},{"rank":2,"ticker":"MPC","momentum":146.3456312593,"atr":3.878795,"price":87.29,"sector":"Energy","shares":64,"position":5586.56},{"rank":3,"ticker":"XOM","momentum":73.422486679,"atr":3.125265,"price":86.12,"sector":"Energy","shares":79,"position":6803.48},{"rank":4,"ticker":"MRK","momentum":61.2807974234,"atr":1.75975,"price":84.62,"sector":"Health Care","shares":142,"position":12016.04},{"rank":5,"ticker":"LLY","momentum":57.9475669598,"atr":9.22375,"price":290.9,"sector":"Health Care","shares":27,"position":7854.3},{"rank":6,"ticker":"PSX","momentum":51.3789858859,"atr":3.772015,"price":90.51,"sector":"Energy","shares":66,"position":5973.66},{"rank":7,"ticker":"T","momentum":49.0207879495,"atr":0.43148,"price":19.38,"sector":"Communication Services","shares":579,"position":11221.02},{"rank":8,"ticker":"WRB","momentum":40.6794172952,"atr":1.495505,"price":66.82,"sector":"Financials","shares":167,"position":11158.94},{"rank":9,"ticker":"BMY","momentum":30.433744447,"atr":1.43868,"price":73.77,"sector":"Health Care","shares":173,"position":12762.21},{"rank":10,"ticker":"MNST","momentum":21.3035927433,"atr":2.23185,"price":88.12,"sector":"Consumer Staples","shares":112,"position":9869.44},{"rank":11,"ticker":"NOC","momentum":20.1797508524,"atr":13.0468,"price":443.93,"sector":"Industrials","shares":19,"position":8434.67},{"rank":12,"ticker":"IBM","momentum":17.2838048274,"atr":3.04094,"price":135.02,"sector":"Information Technology","shares":82,"position":11071.64},{"rank":13,"ticker":"VICI","momentum":11.8573645094,"atr":1.04302,"price":28.81,"sector":"Real Estate","shares":239,"position":6885.59},{"rank":14,"ticker":"DG","momentum":10.827248949,"atr":8.083975,"price":230.8,"sector":"Consumer Discretionary","shares":30,"position":6924.0},{"rank":15,"ticker":"TMUS","momentum":3.5277706342,"atr":3.37147,"price":127.59,"sector":"Communication Services","shares":74,"position":9441.66},{"rank":16,"ticker":"ULTA","momentum":3.3921357124,"atr":17.910045,"price":395.83,"sector":"Consumer Discretionary","shares":13,"position":5145.79},{"rank":17,"ticker":"CTLT","momentum":0.0141688573,"atr":3.710275,"price":102.51,"sector":"Health Care","shares":67,"position":6868.17},{"rank":18,"ticker":"BF.B","momentum":-0.0000161821,"atr":1.67156,"price":66.57,"sector":"Consumer Staples","shares":149,"position":9918.93}];

        const sectorTypes = ["Communication Services", "Consumer Discretionary", "Consumer Staples", "Energy", "Financials", "Health Care", "Industrials", "Information Technology", "Materials", "Real Estate", "Utilities"];
        function multiSelectHeaderFilter(cell) {
            var values = sectorTypes;

            const filterFunc = (rowData) => {
                return values.includes(rowData['sector']);
            }

            const getSelectedValues = (multiSelect) => {
                var result = [];
                var options = multiSelect && multiSelect.options;
                var opt;

                for (var i = 0, iLen = options.length; i < iLen; i++) {
                opt = options[i];

                if (opt.selected) {
                    result.push(opt.value || opt.text);
                }
                }
                return result;
            }

            const onChange = () => {
                var editor = document.getElementById('sectorSelector');
                values = getSelectedValues(editor);
                console.log("values: " + values);
                cell.getColumn().getTable().removeFilter(filterFunc);
                cell.getColumn().getTable().addFilter(filterFunc);
            }

            var select = document.createElement("select");
            select.multiple = "multiple";
            select.id = 'sectorSelector';
            select.class = "chosen-select";
            select.style = 'width: 100%';
            sectorTypes.forEach(sector => {
                select.innerHTML += "<option id='" + sector + "' value='" + sector + "' selected='selected'>" + sector + "</option>";
            });
            cell.getColumn().getTable().addFilter(filterFunc);
            select.addEventListener('change', onChange);

            return select;
        }

        var table = new Tabulator("#sp500", {
            data: tabledata,
            layout: "fitColumns",
            pagination: "local",
            paginationSize: 500,
            tooltips: true,
            columns: [{
                    title: "Rank",
                    field: "rank",
                    sorter: "number",
                }, 
                {
                    title: "Ticker",
                    field: "ticker",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: "input"
                },
                {
                    title: "Sector",
                    field: "sector",
                    sorter: "string",
                    hozAlign: "left",
                    headerFilter: multiSelectHeaderFilter, 
                    headerFilterLiveFilter: false
                },
                {
                    title: "Momentum",
                    field: "momentum",
                    sorter: "number",
                    hozAlign: "left",
                }, 
                {
                    title: "ATR20d",
                    field: "atr",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Price ($)",
                    field: "price",
                    sorter: "money",
                    hozAlign: "left",
                },
                {
                    title: "Shares",
                    field: "shares",
                    sorter: "number",
                    hozAlign: "left",
                },
                {
                    title: "Position ($)",
                    field: "position",
                    sorter: "money",
                    hozAlign: "left",
                },
            ],
        });
    </script>
</body>

</html>
